{{define "layout"}}
<!DOCTYPE html>
<html>
<head>
    <title>{{.SiteTitle}}</title>
    <style>{{.CSS}}</style>
</head>
<body>
    {{if .Flash}}
    <div id="toast" class="toast">
        {{.Flash}}
    </div>
    <script>
        setTimeout(() => {
            const t = document.getElementById('toast');
            if (t) t.style.opacity = '0';
            setTimeout(() => { if (t) t.remove(); }, 300);
        }, 3000);
    </script>
    {{end}}

    <div class="sidebar">
        <h1>{{.SiteTitle}}</h1>
        
        <div style="padding: 0 1rem 1.5rem 1rem;">
            <input type="text" id="resource-search" placeholder="Search resources..." 
                   style="width: 100%; padding: 0.6rem; background: #334155; border: 1px solid #475569; border-radius: 0.375rem; color: white; font-size: 0.8125rem; outline: none;">
        </div>

        <a href="/admin" class="nav-item">Dashboard</a>
        
        <div id="nav-groups" style="margin-top: 1rem;">
            {{range $group, $resList := .GroupedResources}}
                <div class="nav-group" data-group-name="{{$group}}">
                    {{if ne $group "Default"}}
                        <div class="group-header" style="padding: 0.75rem 1rem; font-size: 0.75rem; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 700; margin-top: 1rem;">
                            {{$group}}
                        </div>
                    {{end}}
                    {{range $resList}}
                        <a href="/admin/{{.Name}}" class="nav-item {{if eq $group "Default"}}{{else}}nested{{end}}" data-resource-name="{{.Name}}">
                            {{.Name}}
                        </a>
                    {{end}}
                </div>
            {{end}}

            {{range $group, $pageList := .GroupedPages}}
                <div class="nav-group" data-group-name="{{$group}}">
                    {{if and (ne $group "Default") (not (index $.GroupedResources $group))}}
                        <div class="group-header" style="padding: 0.75rem 1rem; font-size: 0.75rem; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 700; margin-top: 1rem;">
                            {{$group}}
                        </div>
                    {{end}}
                    {{range $pageList}}
                        <a href="/admin/{{.Name}}" class="nav-item {{if eq $group "Default"}}{{else}}nested{{end}}" data-resource-name="{{.Name}}">
                            {{.Name}}
                        </a>
                    {{end}}
                </div>
            {{end}}
        </div>

        <div style="margin-top: 2rem; padding: 1rem; border-top: 1px solid #334155;">
            <a href="/admin/logout" class="nav-item" style="color: #f87171;">Logout</a>
        </div>
    </div>
    
    <div class="main">
        <div class="header">
            <h2>{{template "title" .}}</h2>
            {{template "actions" .}}
        </div>
        <div class="card">
            {{template "content" .}}
        </div>
    </div>

    <script>
        document.getElementById('resource-search').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            const groups = document.querySelectorAll('.nav-group');
            groups.forEach(group => {
                const items = group.querySelectorAll('[data-resource-name]');
                let hasVisibleItem = false;
                items.forEach(item => {
                    const name = item.getAttribute('data-resource-name').toLowerCase();
                    if (name.includes(query)) { item.style.display = 'block'; hasVisibleItem = true; } else { item.style.display = 'none'; }
                });
                group.style.display = hasVisibleItem ? 'block' : 'none';
            });
        });
    </script>
</body>
</html>
{{end}}
{{define "actions"}}{{end}}
